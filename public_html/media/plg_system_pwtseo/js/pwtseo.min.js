jQuery(document).ready(function(){function a(a,b){return((b||"").match(new RegExp(a,"ig"))||[]).length}function b(a){return a.replace(/(<([^>]+)>)|(\{[^\}]+\})/gi," ").split(" ").filter(function(a){return a.length>0}).join(" ")}function c(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/\{(\d+)\}/g,function(a,c){return void 0!==b[c]?b[c]:a})}var d={props:["localConfig","page","pluginConfig"],template:'        <div  class="test" :class="classes" :data-js-score="score">        <div class="pseo-score__content">{{ message }}</div>        </div>',data:function(){return{testname:"testname",messages:["init"],weight:1}},watch:{score:function(){this.$emit("score-change",{label:this.testname,score:this.score,weight:this.weight})}},computed:{message:function(){if(this.score>-1)return this.messages[this.score]},color:function(){return this.score},classes:function(){return"seo-test"+(-1!==this.score?" score-"+this.color:"")}}};Vue.component("test-keyword-in-title",{data:function(){return{testname:"Keyword in title",messages:[this.pluginConfig.requirements_article_title_bad,"",this.pluginConfig.requirements_article_title_good]}},computed:{score:function(){return this.localConfig.focusWord.length?a(this.localConfig.focusWord,this.page.title)>0?2:0:-1}},mixins:[d]}),Vue.component("test-page-title",{data:function(){return{testname:"Keyword in title",messages:[this.pluginConfig.requirements_page_title_bad,"",this.pluginConfig.requirements_page_title_good],weight:2}},computed:{score:function(){return this.localConfig.focusWord.length&&this.page.pagetitle.length?a(this.localConfig.focusWord,this.page.pagetitle)>0?2:0:-1}},mixins:[d]}),Vue.component("test-page-title-length",{data:function(){return{testname:"Pagetitle length",messages:["",this.pluginConfig.requirements_page_title_length_too_few_bad,this.pluginConfig.requirements_page_title_length_too_much_bad,this.pluginConfig.requirements_page_title_length_too_few_medium,this.pluginConfig.requirements_page_title_length_too_much_medium,this.pluginConfig.requirements_page_title_length_good],weight:2}},computed:{score:function(){if(!this.localConfig.focusWord.length||!this.page.pagetitle.length)return-1;var a=this.page.pagetitle.length;return a>=40&&a<=49?5:a<25?1:a>60?2:3},color:function(){return this.score<3?1:this.score<5?1:2}},mixins:[d]}),Vue.component("test-keyword-in-meta",{data:function(){return{testname:"Keyword in meta description",messages:[this.pluginConfig.requirements_meta_description_none,this.pluginConfig.requirements_meta_description_too_short_medium,this.pluginConfig.requirements_meta_description_too_long_medium,this.pluginConfig.requirements_meta_description_medium,this.pluginConfig.requirements_meta_description_good]}},computed:{score:function(){return this.localConfig.focusWord.length?0===this.page.metadesc.length?0:this.page.metadesc.length<100?1:this.page.metadesc.length>150?2:a(this.localConfig.focusWord,this.page.metadesc)>0?4:3:-1},color:function(){return 4===this.score?2:1}},mixins:[d]}),Vue.component("test-keyword-in-url",{data:function(){return{testname:"Keyword in url",messages:[this.pluginConfig.requirements_in_url_bad,"",this.pluginConfig.requirements_in_url_good]}},computed:{score:function(){return this.localConfig.focusWord.length&&this.page.url.length?a(this.localConfig.focusWord,this.page.url.replace(/-/g," "))>0?2:0:-1}},mixins:[d]}),Vue.component("test-keyword-not-used",{data:function(){return{testname:"Keyword is not used prior",messages:[this.pluginConfig.requirements_not_used_bad,this.pluginConfig.requirements_not_used_bad,this.pluginConfig.requirements_not_used_medium,this.pluginConfig.requirements_not_used_good]}},computed:{score:function(){return""!==this.page.count&&this.localConfig.focusWord.length?0===this.page.count?3:1===this.page.count?2:1:-1},color:function(){return 3===this.score?2:1}},mixins:[d]}),Vue.component("test-body-has-images",{data:function(){return{testname:"Body has images",messages:[this.pluginConfig.requirements_images_none,this.pluginConfig.requirements_images_bad,this.pluginConfig.requirements_images_good]}},computed:{score:function(){if(!this.page.body.length||!this.localConfig.focusWord.length)return-1;var a=this.page.body.match(/<img.*?>/g)||[];if(!a.length)return 0;for(var b=a.length;b--;)if((a[b].match(new RegExp("alt=['|\"].*?"+this.localConfig.focusWord+".*?['|\"]","ig"))||[]).length>0)return 2;return 1}},mixins:[d]}),Vue.component("test-result-body-has-images",{data:function(){return{testname:"Resulting body has images",messages:[this.pluginConfig.requirements_images_resulting_none,this.pluginConfig.requirements_images_resulting_bad,this.pluginConfig.requirements_images_resulting_good]}},computed:{score:function(){return-1},message:function(){if(this.page.final_html.length&&this.localConfig.focusWord.length){var a=this.page.final_html.match(/<img.*?>/g)||[];if(!a.length)return this.messages[0];for(var b=a.length;b--;)if((a[b].match(new RegExp("alt=['|\"].*?"+this.localConfig.focusWord+".*?['|\"]","ig"))||[]).length>0)return this.messages[2];return this.messages[1]}}},mixins:[d]}),Vue.component("test-body-has-heading",{data:function(){return{testname:"Body has headings",messages:[this.pluginConfig.requirements_subheadings_none,this.pluginConfig.requirements_subheadings_bad,this.pluginConfig.requirements_subheadings_good]}},computed:{score:function(){if(!this.page.body.length||!this.localConfig.focusWord.length)return-1;var c=this.page.body.match(/\<[h|H]\d.*?\>(.*?)\<\/[h|H]\d\>/g)||[];if(!c.length)return 0;for(var d=c.length;d--;)if(a(this.localConfig.focusWord,b(c[d])))return 2;return 1}},mixins:[d]}),Vue.component("test-body-has-paragraph-first",{data:function(){return{testname:"Body has paragraph as first element",messages:[this.pluginConfig.requirements_first_paragraph_none,this.pluginConfig.requirements_first_paragraph_bad,this.pluginConfig.requirements_first_paragraph_good]}},computed:{score:function(){if(!this.page.body.length||!this.localConfig.focusWord.length)return-1;var a=this.page.body.split("</p>");return a.length?(b(a[0]).match(new RegExp(this.localConfig.focusWord,"ig"))||[]).length>0?2:1:0}},mixins:[d]}),Vue.component("test-body-keyword-density",{data:function(){return{testname:"Body keyword density",messages:[this.pluginConfig.requirements_density_none,this.pluginConfig.requirements_density_too_few_bad,this.pluginConfig.requirements_density_too_much_bad,this.pluginConfig.requirements_density_too_few_medium,this.pluginConfig.requirements_density_good],density:0,timesFound:0}},computed:{score:function(){if(!this.page.body.length||!this.localConfig.focusWord.length)return-1;var a=b(this.page.body.toLowerCase()).match(/\b(\w+)\b/g)||[],c=_.countBy(a);return this.timesFound=c[this.localConfig.focusWord]||0,this.density=(100*this.timesFound/a.length).toFixed(2),this.density<1?1:this.density>=1&&this.density<=3?4:(this.density,2)},color:function(){return 4===this.score?2:1},message:function(){if(this.score>-1)return c(this.messages[this.score],this.density,this.timesFound)}},mixins:[d]}),Vue.component("test-result-body-keyword-density",{data:function(){return{testname:"Resulting body keyword density",messages:[this.pluginConfig.requirements_density_none,this.pluginConfig.requirements_density_resulting_too_few_bad,this.pluginConfig.requirements_density_resulting_too_much_bad,this.pluginConfig.requirements_density_resulting_too_few_medium,this.pluginConfig.requirements_density_resulting_good],density:0,timesFound:0}},computed:{score:function(){return-1},message:function(){if(this.page.final_html.length&&this.localConfig.focusWord.length){var a=b(this.page.final_html.toLowerCase()).match(/\b(\w+)\b/g),d=_.countBy(a);return this.timesFound=d[this.localConfig.focusWord]||0,this.density=(100*this.timesFound/a.length).toFixed(2),this.density<1?c(this.messages[1],this.density,this.timesFound):this.density>=1&&this.density<=3?c(this.messages[4],this.density,this.timesFound):(this.density,c(this.messages[2],this.density,this.timesFound))}}},mixins:[d]}),Vue.component("test-body-length",{data:function(){return{testname:"Body sufficient length",messages:[this.pluginConfig.requirements_length_none,this.pluginConfig.requirements_length_bad,this.pluginConfig.requirements_length_medium,this.pluginConfig.requirements_length_good],totalWords:0}},computed:{score:function(){return this.page.body.length&&this.localConfig.focusWord.length?(this.totalWords=_.words(b(this.page.body)).length,this.totalWords<100?1:this.totalWords>250?3:2):-1},color:function(){return 3===this.score?2:1},message:function(){if(this.score>-1)return c(this.messages[this.score],this.totalWords)}},mixins:[d]}),Vue.component("test-robots-reachable",{data:function(){return{testname:"Is page reachable for robots",messages:[this.pluginConfig.requirements_robots_reachable_bad,"",this.pluginConfig.requirements_robots_reachable_good]}},computed:{score:function(){return""!==this.page.reachable&&this.localConfig.focusWord.length?this.page.reachable?2:0:-1}},mixins:[d]}),new Vue({el:"#attrib-seofieldset",data:{localConfig:{focusWord:"",editor:null},page:{title:"",pagetitle:"",body:"",final_html:"",metadesc:"",url:"",count:"",reachable:""},pluginConfig:{},scores:[]},methods:{getAjaxResponse:_.debounce(function(){if(this.localConfig.focusWord=this.getValue("jform_seo_focus_word").toLowerCase(),this.localConfig.focusWord.length>2){var a=jQuery("#item-form").serializeArray();a.push({name:"group",value:"content"}),a.push({name:"plugin",value:"PWTSEOPage"});for(var b=a.length;b--;)if("jform[articletext]"===a[b].name){try{a[b].value=this.getBodyContent()}catch(a){}break}var c=this;jQuery.ajax({url:this.pluginConfig.frontajaxurl,method:"post",data:a,beforeSend:function(){},complete:function(){},success:function(b){if(b&&!0===b.success){var d=b.data[0];c.page.count=d.count,c.page.reachable=d.reachable,c.page.url=d.url,a.push({name:"pwtseo_preview",value:1}),jQuery.ajax({url:d.url,method:"post",data:a,success:function(a,b,d){200===d.status?(c.page.title=c.getPageTitle(),c.page.pagetitle=a.match(/\<title\>(.*?)\<\/title\>/)[1]||c.getPageTitle(),c.page.body=c.getBodyContent(),c.page.final_html=a||c.getBodyContent(),c.page.metadesc=a.match(/\<meta name=["']description["'] content=["'](.*?)["'] \/\>/i)[1]||c.getMetaDescription()):(c.page.title=c.getPageTitle(),c.page.pagetitle=c.getPageTitle(),c.page.body=c.getBodyContent(),c.page.final_html=c.getBodyContent(),c.page.metadesc=c.getMetaDescription())},error:function(){c.page.title=c.getPageTitle(),c.page.pagetitle=c.getPageTitle(),c.page.body=c.getBodyContent(),c.page.final_html=c.getBodyContent(),c.page.metadesc=c.getMetaDescription()}})}}})}},500),addListener:function(a,b,c){var d=document.getElementById(a);d&&void 0!==d&&d.addEventListener(b,c)},getValue:function(a){return document.getElementById(a)&&void 0!==document.getElementById(a)?document.getElementById(a).value:""},calculateTotalScore:function(a){var b=_.findIndex(this.scores,["label",a.label]);b>-1?Vue.set(this.scores,b,a):this.scores.push(a)},getBodyContent:function(){var a=_.find(tinyMCE.editors,function(a){return"jform_articletext"===a.id&&!a.hidden});return a?a.getContent({format:"raw"}):this.getValue("jform_articletext")},getPageTitle:function(){return"1"===this.getValue("jform_seo_override_page_title")?this.getValue("jform_seo_page_title"):this.getValue("jform_title")},getMetaDescription:function(){return this.getValue("jform_metadesc")}},computed:{totalScore:function(){var a=this.scores.reduce(function(a,b){return b.score>-1?a+=b.score*b.weight:a},0);return Math.round(100*a/32)}},filters:{truncate:_.truncate},created:function(){jQuery('input[type="hidden"][id^="jform_seo"].js-remove').remove(),this.getAjaxResponse(),this.pluginConfig=Joomla.getOptions("PWTSeoConfig");var a=this;setTimeout(function(){if(a.addListener("jform_title","keyup",a.getAjaxResponse),a.addListener("jform_seo_focus_word","keyup",a.getAjaxResponse),a.addListener("jform_metadesc","keyup",a.getAjaxResponse),a.addListener("jform_seo_page_title","keyup",a.getAjaxResponse),jQuery("#jform_seo_override_page_title").chosen().change(a.getAjaxResponse),a.pluginConfig.show_counters){var b=jQuery("#jform_title"),c=jQuery("#jform_metadesc"),d=jQuery("#jform_seo_page_title");b.addClass("pseo-title").after('<span class="pseo-title-counter"><span class="js-pwtseo-title-counter-amount">'+b.val().length+"</span>/45</span>"),a.addListener("jform_title","keyup",function(){document.getElementsByClassName("js-pwtseo-title-counter-amount")[0].innerHTML=this.value.length}),c.length&&(c.after('<span class="js-pwtseo-metadescription-counter-amount">'+c.val().length+"</span>"),a.addListener("jform_metadesc","keyup",function(){document.getElementsByClassName("js-pwtseo-metadescription-counter-amount")[0].innerHTML=this.value.length})),d.length&&(d.after('<span class="pseo-title-counter"><span class="js-pwtseo-pagetitle-counter-amount">'+d.val().length+"</span>/45</span>"),a.addListener("jform_seo_page_title","keyup",function(){document.getElementsByClassName("js-pwtseo-pagetitle-counter-amount")[0].innerHTML=this.value.length}))}var e=_.find(tinyMCE.editors,function(a){return"jform_articletext"===a.id&&!a.hidden});e&&("undefined"!=typeof WFEditor?e.onKeyUp.add(a.getAjaxResponse):e.on("keyup",a.getAjaxResponse))},0);var b=setInterval(function(){var a=jQuery('a[href="#attrib-seofieldset"]');a.length&&(clearInterval(b),jQuery(a[0]).append(jQuery("<span />").attr("id","pwtseo__totalscore")))},200)},watch:{totalScore:function(){var a=jQuery("#pwtseo__totalscore"),b=this.totalScore;a.html(b).removeClass(function(a,b){return(b.match(/(^|\s)seoscore-\S+/g)||[]).join(" ")}).addClass(function(){return b<40?"seoscore-0":b<75?"seoscore-1":"seoscore-2"}),jQuery("#jform_seo_pwtseo_score").val(b)}}})});